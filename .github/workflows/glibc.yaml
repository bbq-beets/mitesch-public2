name: glibc
# This workflow tests examples from the examples directory of this repo.

on:
  push:
    branches: 
      - main
  workflow_dispatch:
    inputs:
      version:
        default: import/2.39-7

jobs:
  do-test:
    strategy:
      fail-fast: false
      matrix:
        version: [ 5199024232eb9da46150c73af3a198185aa48aa6, 748e23afb5263631a61528f628562e707f072f9a, 90dffec958f4d423435d155939ef8abf4fedd1f1, 33f0f58b59751a0cb0dd1611175d0211f567bede, 8394b8c4617c925d7a7fab567401f07549d07b13, ad098893ba3c3344a5f2f6ab1627c47204afdb47, 51541a229740801882490177fa178e49264b13fb, 569cfcc6bf35c28112ca8d7112e9eb4a22bed5b8, 02abdab0d1a28a36b21ad2f263c94f11fad98f24, 0b3503e2e19602db9cda47915d19a26c00f59bb1, 6d7e8eda9b85b08f207a6dc6f187e94e4817270f, 35141f304e319109c322f797ae71c0b9420ccb05, 5f55b22f4b3ea14c777a60f239d25dc4555eb804, f77bd0ee9a4a7ef7295f3a35a0ca67c95c4e1bd6, 289b098c9e21e2805e3835f9b5780235ab14a290, 81a94a2ae34bac9c3d907bbe0468ba56914accb0, 5ab9b2c92411eb52f7b7a8e6074f0740d9bd727b, af7f4165512ea242b5f711ee03a04f6afe22232d, 46378560e056300623364669de2405a7182b064f, edd1b2a0d9025b849a87f9b7eec616eb820e4fe2, 0fb10e49ad169374650534509767ec1d4232e230, b712be52645282c706a5faa038242504feb06db5, 4e21c2075193e406a92c0d1cb091a7c804fda4d9, 929ea132b43dbec93e5f4d28f316d37ede91a635, 127945c561535be3975d418fa8f85334a76c298c, 215bf99347be78f80ea1e9d7d717a4b67616e28d, bf58f34a708055361056907511c625449b7d27d6, f178e5173f737c33f421a7a994a3ab67a8a4eb86, 33ef940302eba1ecf9e98376557af75d7d9c0ed1, 36d423e2032e98305799071b831691fc4c06deea, 6cfc50f40a5e59bc46d8b45bc7520f719e86af1e, 2f47198b04a02097f438ecb765306fa39568a006, 987f8647e8d6206cebc613e5c162ff8b4d014d40, e3d9ca4e9474ed4f9b6a9879867f14fea6e2bee9, a1981ecbfd4aec84dea26936d91c8ed9164f8b13, f704192911c6c7b65a54beab3ab369fca7609a5d, e1d082d9de391d07c0c96b5f3408a9d2857860c1, a9acb7b39ed21386142b963aeecc35e0b468c0de, 73e35174f5673d58cb8e1bd5f34c086a7759ff20, 56da6a073daaf86a7044df22b8778e913db5099c, 049781285dad97e33c6d54e5c6e3c8c6f6eda69e, 642933158e7cf072d873231b1a9bb03291f2b989, 419c832aba43276e285586998261d1db06033193, 8d291eabd541029d7ac705cc1ea112c58dfbb05f, 2ff48a4025515e93d722947a9eabb114f4a65b22, d33705c0b020632274318323931695a99753b5be, 7457b7eef8dfe8cc48e55b9f9837df6dd397b80d, 34b358eb03e592fadd9887dd3ef8c1cfaba39688, d227fd53cbbc9ae7e5604da3669d04b6ccb53aa1, bbff275fb1b16f5b7dd95933bde6e1e496414dbf, 2eeeee7636cb52a09740598404808def17cf750e, b866018f54ad0670ee9b930a14ae6e8960b9f4bf, 3fa20d59d9607e4494dfbc99bacee1935ec5ded9, 0b845d3b3fde40e72c5372d6fa0f129b5e45c363, 77db67c56b24bba3c735aac34a6f796c909b68c0, 891a7958a28eac6d4af1517dd2896fef5e4951d4, 2b5478569e72ee4820a6e163d306690c9c0eaf5e, b87a70e5e26e2656637da5f58ba4d26777d9e37b, b6d02d64570e83bedfdb946cb1bdf0c9fd6d3eb0, 0ff92021c045ee53b91bd42fa3fbbb923a6ffb17, 4af6844aa5d3577e327f15dd877a38a043cb236a, 451c6e58540e8571e31581c04c4829e5d2cfe8ac, 246f37d6b1c4c6c0a6365df8783e62e3adf208e8, a6784653f77e77c1f91dedcb524dcb3851d49fc9, 2c42257314536b94cc8d52edede86e94e98c1436, 264db94040c463d9bc356101595d89335586875e, 589eda82bb2ff210c33003beef239eedea1f9cac, e76369ed6371734f77f468eab097ef4e5b5db1c5, 4a7094119ce05cadf927f52cc5d723e2195e65f9, 7fe6734d28feb18acb3c50b13a5f5a52f66d39cf, cbf24edbb3123e3154ad2366912e0c1270ad3546, a878a1384c8f7ae2383c4413feab88ba2fee7f17, 7e8283170c5d6805b609a040801d819e362a6292, fc7de1d9b99ae1676bc626ddca422d7abee0eb48, 653c12c7d880340462bd963752619a7a61bcb4e3, 3bea50ccbc925d4fc5f85ec402b6154cbe770b71, 13db9ee2cb3b77e25f852be7d6952882e1be6f00, 3e5760fcb48528d48deeb60cb885a97bb731160c, 22f4ab2d200f605441cdd2b49ec9c97d43eb11c9, d1babeb32de5dae8893c640bd925357b218d846c, 340097d0b50eff9d3058e06c6989ae398c653d4a, 73e9fe43acb15722ebe06de741dbdb8cdb768ad1, fd36873ff9d766f5095d81bdfba900adfff5f784, 85a322874404d1a13e9d628b8bc44120cabf7e12, f97905f24631097af325d6a231093071c3077a5f, 6841aed6c4abde1aa7015348496c86cadc227a1f, 05967faf0e3df6aad07f0b05e138e86f82363deb, 1918241b55540536fee45b3096e786b7b7f9277a, 82a1ec851025ccae54dea43149915707f890746b, 89d40cacd0aed35e2546513ce01924b879523e46, 2fc7320668ee843f9d1e5a2ec6c6fdbf00c735a3, 45459476ecc8fe315734912baf7adf3551cff640, c7509d49c4e8fa494120c5ead21338559dad16f5, 6c4ee1aba17f1e71b9ec856479260de9d362fdb6, 32b599ac8c21c4c332cc3900a792a1395bca79c7, 0dcc43e9981005540bf39dc7bf33fbab62cf9e84, c79327bf00a4be6d60259227acc78ef80ead3622, fa9e095bbe9b624022ff77551e5998100bdc4b29, 063f7462dac26487e38b126afcf80dad77da444c, 06d4381dd81eaab16b538017adc5854033f44b6d, 6f85dbf102ad7982409ba0fe96886caeb6389fef, bd13cb19f5e15e9e9a92a536e755fd93a97a67f6, 4c199499d65bb06d304ec1b734de738b8f252b97, 9125e43daf92e3d4e69044a54b9fe9ed88c861ad, 2955ef4b7c9b56fcd7abfeddef7ee83c60abff98, f82e05ebb295cadd35f7372f652c72264da810ad, e1226cdc6b209539a92d32d5b620ba53fd35abf3, 1c9bc1b6e50293a1b7037a7bfbf835868a55baed, 61d2066c193472ca324b851e7f9b3668592913f0, 8bc3f94a062776abfaf14201fba37bea5328bf92, ed0185e4129130cbe081c221efb758fb400623ce, 36676f5e5d6ed17263f4f5089e77f480b852bd74, 3e838436370cd97ffaacec5cb663aa03f97a16db, cca9684f2d7a74fc0b28bfb1859955e0e28d7b4b, 521d54056242aae41ad362bd95ab17c50138337a, 032712621fd376def8ee4c1d997b414f29a30108]
        #version: [77db67c56b24bba3c735aac34a6f796c909b68c0, 11306df777e4355bb94f3581fcd2207a525d47dd, e6f3fe362f1aab78b1448d69ecdbd9e3872636d3, a8e72913fea0c6e2832c50523c60907ffa3b753b, 891a7958a28eac6d4af1517dd2896fef5e4951d4]
        testNum: [1] #[1,2,3,4,5,6,7,8,9,10]
        os: [ ubuntu-22.04-arm ]
    runs-on: ${{ matrix.os }}
    
    timeout-minutes: 25
    steps:
      - name: vm info
        run: |
          curl -s -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance?api-version=2021-02-01" | jq      
          echo '::warning:: ' $(curl -s -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance?api-version=2021-02-01" | jq | grep "vmSize")
          sudo sysctl -w kernel.print-fatal-signals=1

      # git clone https://git.launchpad.net/~ubuntu-core-dev/ubuntu/+source/glibc glibc
      - name: clone glibc
        run: |
          mkdir $HOME/src
          cd $HOME/src
          git clone https://github.com/mitesch/glibc-mirror glibc
          cd glibc
          git checkout ${{ matrix.version }}
          mkdir -p $HOME/build/glibc
        
      - name: build glibc
        run: |
          cd $HOME/build/glibc
          sed -i 's/^# PARALLELMFLAGS/PARALLELMFLAGS/' $HOME/src/glibc/Makefile.in
          $HOME/src/glibc/configure --prefix=/usr
          make

      - uses: actions/checkout@v4
      - name: test rustc
        run: |
          pwd
          cd $GITHUB_WORKSPACE
          pwd
          pip install pyyaml
          chmod +x runtasks.py
          ./runtasks.py -q tasks-ubuntuglibc-239.yml 


